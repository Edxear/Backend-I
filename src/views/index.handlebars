<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  const socket = io();
  const chatBox = document.getElementById("chatBox");
  let user = "";

  Swal.fire({
    title: "Identificate",
    input: "text",
    text: "Ingresa tu nombre de usuario",
    allowOutsideClick: false,
    inputValidator: (value) => {
      return !value && "Necesitas identificarte para ingresar a la sala";
    }
  }).then(result => {
    if (!result || !result.value) return;
    user = result.value;
    chatBox?.focus();

    chatBox?.addEventListener("keyup", evt => {
      if (evt.key === "Enter") {
        const text = chatBox.value.trim();
        if (text.length > 0) {
          socket.emit("message", { user, message: text });
          chatBox.value = "";
        }
      }
    });
  });

  socket.on("messageLogs", data => {
    console.log(data);
    const log = document.getElementById("messageLogs");
    if (!log || !Array.isArray(data)) return;

    log.innerHTML = data.map(m =>
      `<p><strong>${escapeHtml(m.user)}</strong> dice: ${escapeHtml(m.message)}</p>`
    ).join("");
  });

  function escapeHtml(str) {
    if (str == null) return "";
    return String(str)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }
  
</script>